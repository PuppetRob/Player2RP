
local Pist = {}
local Race = {}
local inRace = false
local currentSession = {}

local boostTimer = 0.0
local spikeTimer = 0.0
local currentKart = 0
local currentPos = 0
local lastPos = 0
-- Pist = DebugPist
-- Race = DebugRace
-- inRace = true
-- DEBUG

function DrawText3Ds(coords, text, scale)
	local x,y,z = coords.x, coords.y, coords.z
	local onScreen, _x, _y = World3dToScreen2d(x, y, z)
	local pX, pY, pZ = table.unpack(GetGameplayCamCoords())

	SetTextScale(scale, scale)
	SetTextFont(4)
	SetTextProportional(1)
	SetTextEntry("STRING")
	SetTextCentre(1)
	SetTextColour(255, 255, 255, 215)

	AddTextComponentString(text)
	DrawText(_x, _y)

	local factor = (string.len(text)) / 320
	local rescale = scale * 1.75
	-- DrawRect(_x, _y + 0.0150, (0.030 + factor)*rescale, 0.025*rescale, 41, 11, 41, 100)
	DrawRect(_x, _y + (0.018*rescale), (0.030 + factor)*(rescale+0.3), 0.025*rescale, 41, 11, 41, 100)
end

--DebugPist = Maps["PlasmaRace 1"]
--Citizen.CreateThread(function()
--	while true do
--		Citizen.Wait(1)
--		for k,v in pairs(DebugPist["CP"]) do
--			-- DrawMarker(0,  v.x,v.y,v.z,  .0,.0,.0,  .0,.0,v.h,  10.0,2.5,10.0,  128,0,0,64, false,false,2,false)
--			DrawMarker(6,  v.x,v.y,v.z,  .0,.0,.0,  .0,.0,v.h,  15.0,2.5,10.0,  0,255,128,64, false,false,2,false)
--			DrawText3Ds(v,k,0.5)
--		end
--		for k,v in pairs(DebugPist["startPos"]) do
--			DrawMarker(0,  v.x,v.y,v.z,  .0,.0,.0,  .0,.0,v.h,  1.0,1.0,1.0,  128,0,0,64, false,false,2,false)
--			-- DrawMarker(6,  v.x,v.y,v.z,  .0,.0,.0,  .0,.0,v.h,  15.0,2.5,10.0,  0,0,128,64, false,false,2,false)
--		end
--	end
--end)
--END DEBUG

-- Citizen.CreateThread(function()
		-- for k,v in pairs(DebugPist["startPos"]) do
			-- local kart = CreateVehicle(`veto2`,v.x,v.y,v.z,v.h,true,true)
		-- end
-- end)

local curCP = 0
local curLap = 1
--MARKER
--Citizen.CreateThread(function()
--	while true do
--		if inRace then
--			Citizen.Wait(1)
--			for k,v in pairs(Pist["CP"]) do
--				if k ~= "startPiste" then
--					if k == curCP + 1 or k == curCP + 2 then
--						DrawMarker(6,  v.x,v.y,v.z,  .0,.0,.0,  .0,.0,v.h,  15.0,2.5,10.0,  0,0,128,64, false,false,2,false)
--					else
--						if (curCP + 2) > #Pist then
--							if k == 1 then
--								DrawMarker(6,  v.x,v.y,v.z,  .0,.0,.0,  .0,.0,v.h,  15.0,2.5,10.0,  0,0,128,64, false,false,2,false)
--							end
--						end
--					end
--				end
--				if k == "startPiste" then
--					DrawMarker(6,  v.x,v.y,v.z,  .0,.0,.0,  .0,.0,v.h,  20.0,2.5,10.0,  0,128,0,64, false,false,2,false)
--				end
--			end
--		else
--			Citizen.Wait(1000)
--		end
--	end
--end)

Citizen.CreateThread(function()

	for k,v in pairs(Shop) do
		-- v["blip"]
		-- print("k : "..tostring(k).." v : "..tostring(v["Blip"].x))
		blip=AddBlipForCoord(v["Blip"].x,v["Blip"].y,v["Blip"].z)

		SetBlipSprite(blip, v["Blip"].sprite)
		SetBlipScale(blip, v["Blip"].scale)
		SetBlipColour(blip, v["Blip"].colour)
		SetBlipAsShortRange(blip, true)

		BeginTextCommandSetBlipName("STRING")
		AddTextComponentString(tostring(k))
		EndTextCommandSetBlipName(blip)
	
	end
end)

Citizen.CreateThread(function()
	while true do
		if inRace then
			Citizen.Wait(1)
			local cpCoords = {}
			cpCoords.x = 0.0
			cpCoords.y = 0.0
			cpCoords.z = 0.0
			
			if (curCP + 1)>#Pist["CP"] then
				cpCoords = Pist["CP"]["startPiste"]
			else
				cpCoords = Pist["CP"][curCP + 1]
			end
			-- DrawMarker(1,  cpCoords.x,cpCoords.y,cpCoords.z,  .0,.0,.0,  .0,.0,cpCoords.h,  15.0,2.5,10.0,  128,0,0,64, false,false,2,false)
			local pos = GetEntityCoords(PlayerPedId(), true)
			if(#(vector3(pos.x, pos.y, pos.z) - vector3(cpCoords.x, cpCoords.y, cpCoords.z)) < 7.5) then
				curCP = curCP + 1
				TriggerServerEvent("PlasmaKart:CpPassed",currentSession["Shop"],curCP,curLap)
				TriggerServerEvent("PlasmaKart:ExtCpPassed",currentSession["Shop"],curCP,curLap,currentKart)
				TriggerEvent("PlasmaKart:ExtCpPassed",currentSession["Shop"],curCP,curLap,currentKart)
				if curCP > #Pist["CP"] then
					curCP = 0
					curLap = curLap + 1
					if curLap > Race["nblap"] then
						inRace = false
						TriggerServerEvent("PlasmaKart:Finish",currentSession["Shop"])
						
						Citizen.CreateThread(function()
							Wait(1000)
							FreezeEntityPosition(currentKart,true)
						end)
					end
				end
			end
		else
			Citizen.Wait(1000)
		end
	end
end)

local function DrawText2D(text,scale,x,y,fontid,colorText)
	SetTextScale(scale, scale)
	SetTextFont(fontid)
	SetTextColour(colorText[1], colorText[2], colorText[3], colorText[4])
	SetTextDropshadow(0, 0, 0, 0, 255)
	SetTextDropShadow()
	SetTextOutline()
	SetTextCentre(true)
	BeginTextCommandDisplayText('STRING')
	AddTextComponentSubstringPlayerName(text)
	EndTextCommandDisplayText(x, y)
	ClearDrawOrigin()
end

local function DrawProgress(xper,text,size,width,height,fontid,x,y,colorValue,colorTrough,colorText)
    if colorTrough and colorTrough[4] > 0 then 
        DrawRect(
            x  --[[ number ]], 
            y   --[[ number ]], 
            0.105 + width --[[ number ]] , 
            height * 2.0 --[[ number ]], 
            colorTrough[1] --[[ integer ]], 
            colorTrough[2] --[[ integer ]], 
            colorTrough[3] --[[ integer ]], 
            colorTrough[4] --[[ integer ]]
        )
    end 
    DrawRect(
        x  + (((0.1+ width) * xper)/2) - (0.1+ width)/2    --[[ number ]], 
        y  --[[ number ]], 
        (0.1+ width) * xper   --[[ number ]], 
        height * 1.5 --[[ number ]], 
        colorValue[1] --[[ integer ]], 
        colorValue[2] --[[ integer ]], 
        colorValue[3] --[[ integer ]], 
        colorValue[4] --[[ integer ]]
    )
    if colorText and colorText[4] > 0 and string.len(text) > 0 then 
        DrawText2D(text,size,x ,y-((height * 1.5)/2)+0.00138888,fontid,colorText)
    end 
end

	



Citizen.CreateThread(function()
	while true do
		if inRace then
			Citizen.Wait(1)
			DisableControlAction(0, 24, true)
			DisableControlAction(0, 25, true)
			DisableControlAction(0, 80, true)
		else
			Citizen.Wait(100)
		end
	end
end)


Citizen.CreateThread(function()
	while true do
		
		if inRace then
			Citizen.Wait(1)
			local time = GetGameTimer() + 1000
			while(GetGameTimer() < time) do
				Citizen.Wait(1)
			end
			if currentSession["Mode"] == "Battle" then
				if boostTimer <1.0 and not (boostTimer>=1.0)then
					boostTimer = boostTimer + 0.10
				end
				if boostTimer > 1.0 then boostTimer = 1.0 end
				if spikeTimer <1.0 and not (spikeTimer>=1.0) then
					spikeTimer = spikeTimer + 0.05
				end
				if spikeTimer > 1.0 then spikeTimer = 1.0 end
			end
		else
			Citizen.Wait(100)
		end
	end
end)

Citizen.CreateThread(function()
	while true do
		if inRace then
			Citizen.Wait(2)
			
			if currentSession["Mode"] == "Battle" then
				-- DrawAdvancedText(0.015,0.35,  0.015,0.035,  0.35,  "texte", 20,20,20,255,4,1)
				-- curLap > Race["nblap"]

				
				DrawProgress(boostTimer,"Boost",0.35,0.015,0.015, 2,0.065,0.665,{64,64,255,128},{0,0,0,200},{255,255,255,255})
				DrawProgress(spikeTimer,"Spike",0.35,0.015,0.015, 2,0.065,0.70,{0,255,0,128},{0,0,0,200},{255,255,255,255})
				DrawAdvancedText(0.1,0.649,0.005,0.0028,0.25,trad[lang]["Boost"],255,255,255,255,0,1)
				DrawAdvancedText(0.1,0.633,0.005,0.0028,0.25,trad[lang]["Spike"],255,255,255,255,0,1)
				DrawAdvancedText(0.1,0.616,0.005,0.0028,0.25,trad[lang]["Reset"],255,255,255,255,0,1)

				if IsDisabledControlJustPressed(0, SpikesKey) then --a
					print("a")
					if spikeTimer >= 1.0 then
						spikeTimer = 0.0
						setSpikesOnGround()
					end
				end
				
				if IsDisabledControlJustPressed(0, BoostKey) then --ctrl
					print("e")
					if boostTimer >= 1.0 then
						boostTimer = 0.0
						boost()
					end
				end
			end
			
			local nbPlayer = #currentSession["Players"]
			
			-- DrawAdvancedText(0.1,0.26,0.005,0.0028,0.6,"LAP: "..tostring(curLap).."/"..tostring(Race["nblap"]),255,255,255,255,7,1)
			-- DrawAdvancedText(0.1,0.22,0.005,0.0028,0.65,"POS: "..tostring(currentPos).."/"..tostring(nbPlayer),255,255,255,255,7,1)
			DrawAdvancedText(LAPCoords.x,LAPCoords.y,LAPCoords.w,LAPCoords.h,0.6,trad[lang]["LAP"]..tostring(curLap).."/"..tostring(Race["nblap"]),255,255,255,255,7,1)
			DrawAdvancedText(POSCoords.x,POSCoords.y,POSCoords.w,POSCoords.h,0.65,trad[lang]["POS"]..tostring(currentPos).."/"..tostring(nbPlayer),255,255,255,255,7,1)
			
			if IsDisabledControlJustPressed(0, ResetKey) and not IsDisabledControlPressed(0, CheckPointResetModifierKey) then --R
				print("R")
				RetournKart()
				Citizen.Wait(1000)
			end
			
			if IsDisabledControlJustPressed(0, ResetKey) and IsDisabledControlPressed(0, CheckPointResetModifierKey) then --R
				ReturnToLastCheckPoint()
				Citizen.Wait(1000)
			end
		else
			Citizen.Wait(1000)
		end
	end
end)


function spawnKart(cylindre)
	FreezeEntityPosition(PlayerPedId(),true)
	local ModelHash = `veto2` -- Use Compile-time hashes to get the hash of this model
	if not IsModelInCdimage(ModelHash) then return end
	RequestModel(ModelHash) -- Request the model
	while not HasModelLoaded(ModelHash) do -- Waits for the model to load with a check so it does not get stuck in an infinite loop
	  Citizen.Wait(10)
	end
	
	-- local ModelHash2 = `prop_runlight_y` -- Use Compile-time hashes to get the hash of this model
	-- if not IsModelInCdimage(ModelHash2) then return end
	-- RequestModel(ModelHash2) -- Request the model
	-- while not HasModelLoaded(ModelHash2) do -- Waits for the model to load with a check so it does not get stuck in an infinite loop
	  -- Citizen.Wait(10)
	-- end
	
	
	local kart = CreateVehicle(ModelHash,GetEntityCoords(PlayerPedId()),GetEntityHeading(PlayerPedId()),true,true)
	if ForcedPlate == true then
		SetVehicleNumberPlateText(kart, ForcedPlateNumber)
	end
	local currentPlate = GetVehicleNumberPlateText(kart)
	FreezeEntityPosition(kart,true)
	SetEntityInvincible(kart,true)
	SetVehicleDoorsLocked(kart,0)
	
	local kartPlate = GetVehicleNumberPlateText(kart)
	
	
	TriggerEvent("PlasmaKart:SpawnedKartFunction",kart,kartPlate)
	TriggerServerEvent("PlasmaKart:ServerSpawnedKartFunction",NetworkGetNetworkIdFromEntity(kart),kartPlate)
	-- local light = CreateObject(ModelHash2,GetEntityCoords(PlayerPedId()),true,true,false)
	
	-- AttachEntityToEntity(light,kart,0, 0.0,0.0,1.5,  0.0,0.0,0.0, false, false, false, false, 0, false)
	FreezeEntityPosition(PlayerPedId(),false)
	print("kart : "..tostring(kart).." exist: "..tostring(DoesEntityExist(kart)))
	SetPedIntoVehicle(PlayerPedId(),kart,-1)
	SetVehicleModKit(kart,0)
	
	local maxLivery = GetNumVehicleMods(kart,48)
	local maxLivery2 = GetNumVehicleMods(kart,48)
	print("maxLivery :"..tostring(maxLivery).." "..tostring(maxLivery2))
	local randLivery = 1
	if maxLivery > 1 then
		randLivery = math.random(1,maxLivery)
	end
	SetVehicleMod(kart,48,randLivery,false)
	SetVehicleColours(kart,math.random(1,117),math.random(1,117))	
	SetVehicleTyresCanBurst(kart,false)

	
	local levelAmel = 0
	local turboOn = false
	if cylindre == "50cc" then
		levelAmel = -1
		SetVehicleMaxSpeed(kart,19.44) --70km/h
	elseif cylindre == "100cc" then
		levelAmel = 0
		SetVehicleMaxSpeed(kart,22.22) --80km/h
	elseif cylindre == "150cc" then
		levelAmel = 1
		turboOn = true
		SetVehicleMaxSpeed(kart,25.0) --90km/h
	elseif cylindre == "200cc" then
		levelAmel = 2
		turboOn = true
	else
		levelAmel = 0
		turboOn = false
	end

	-- brake 0 1 2 3
	-- transm 0 1 2 3
	-- turbo on off
	-- engine 0 1 2 3
	---          -1 de base 0 1 2 3
	print("Set amel level : "..tostring(levelAmel).." turbo on: "..tostring(turboOn))
	SetVehicleMod(kart,11,levelAmel,false)               --engine           
	SetVehicleMod(kart,12,levelAmel,false)               --brake
	SetVehicleMod(kart,13,levelAmel,false)               --transmission
	-- SetVehicleMod(kart,15,levelAmel,false)				--suspension
	
	ToggleVehicleMod(veh, 18, turboOn)  --turbo
	
	currentKart = kart
	
	return kart
	
end


function DrawAdvancedText(x,y ,w,h,sc, text, r,g,b,a,font,jus)
    SetTextFont(font)
    SetTextProportional(0)
    SetTextScale(sc, sc)
	N_0x4e096588b13ffeca(jus)
    SetTextColour(r, g, b, a)
    SetTextDropShadow(0, 0, 0, 0,255)
    SetTextEdge(1, 0, 0, 0, 255)
    SetTextDropShadow()
    SetTextOutline()
    SetTextEntry("STRING")
    AddTextComponentString(text)
	DrawText(x - 0.1+w, y - 0.02+h)
end

function DisplayHelpText(text)
	BeginTextCommandDisplayHelp("STRING")
	AddTextComponentSubstringPlayerName(text)
	DisplayHelpTextFromStringLabel(0, 0, 1, -1)
end



local incircle = {}
Citizen.CreateThread(function()
	local sleep = 2000
	local sleepTrigger1 = false
	while true do
		Wait(sleep)
		local px,py,pz = table.unpack(GetEntityCoords(PlayerPedId(), true))
		sleepTrigger1 = false
		for k,v in pairs(Shop) do
			for k1,v1 in pairs(v) do
				if k1 == "Create" then
					-- print("x : "..tostring(v1.x))
					local pdist = #(vector3(px, py, pz) - vector3(v1.x,v1.y,v1.z))
					if( pdist < 150.0 )then
						sleepTrigger1 = true
						
						DrawMarker(CreateMarker.model, v1.x, v1.y, v1.z , 0, 0, 0, 0, 0, 0, 1.0001, 1.0001, 1.5001, CreateMarker.color.r, CreateMarker.color.g, CreateMarker.color.b,CreateMarker.color.a, 1, 0, 0,0)
						if( pdist < 1.0 )then
							if (incircle[k] == false) then
								DisplayHelpText(trad[lang]["CreateLob"])
								incircle[k] = true
						   end
							if IsControlJustReleased(1, 51) then
								
								EnableGui(true,k)
							end
						elseif ( pdist > 3.0 ) then
							incircle[k] = false
						end
					end
				end
			end
		end
		if sleepTrigger1 then
			sleep = 2
		else
			sleep = 2000
		end
	end
end)



local incircle1 = {}
Citizen.CreateThread(function()
	local sleep = 2000
	local sleepTrigger1 = false
	while true do
		Wait(sleep)
		local px,py,pz = table.unpack(GetEntityCoords(PlayerPedId(), true))
		sleepTrigger1 = false
		for k,v in pairs(Shop) do
			for k1,v1 in pairs(v) do
				if k1 == "Join" then
					local pdist = #(vector3(px, py, pz) - vector3(v1.x,v1.y,v1.z))
					if( pdist < 150.0 )then
						sleepTrigger1 = true
						DrawMarker(JoinMarker.model, v1.x, v1.y, v1.z , 0, 0, 0, 0, 0, 0, 1.0001, 1.0001, 1.5001, JoinMarker.color.r, JoinMarker.color.g, JoinMarker.color.b,JoinMarker.color.a, 1, 0, 0,0)
						if( pdist < 1.0 )then
							if (incircle1[k] == false) then
								DisplayHelpText(trad[lang]["JoinLob"])
								incircle1[k] = true
						   end
							if IsControlJustReleased(1, 51) then
								TriggerServerEvent("PlasmaKart:GetSession",k)
							end
						elseif ( pdist > 3.0 ) then
							incircle1[k] = false
							mainMenu:Visible(false)
						end
					end
				end
			end
		end
		if sleepTrigger1 then
			sleep = 2
		else
			sleep = 2000
		end
	end
end)

function teleport(coords)
	SetEntityCoords(PlayerPedId(),coords.x,coords.y,coords.z)
	SetEntityHeading(PlayerPedId(),coords.h)
end

function EnableGui(state,shop)
	SetNuiFocus(state, state)
	guiEnabled = state

	SendNUIMessage({
		type = "enableui",
		enable = state,
		shop = shop
	})
end

RegisterNUICallback('escape', function(data, cb)
	EnableGui(false)
end)

RegisterNUICallback('validate', function(data, cb)
	-- if hasIdentity then
	local reason = ""
	local gamemodeAvailable = false
	local gamemodeAvailable2 = false
	local mapsAvailable = false
	EnableGui(false)
	print("validate shop : "..tostring(data["maps"]))
	for theData, value in pairs(data) do
		if theData == "sessionname" then
			if value == "" or value == nil then
				reason = trad[lang]["InvalidSession"]
				break
			end
		elseif theData == "gamemode" then
			for k,v in pairs(Shop[data["curshop"]]["ModAvailable"]) do
				if v == value then
					gamemodeAvailable = true
					break
				end
			end
			if Maps[data["maps"]][value] then
				gamemodeAvailable2 = true
			end
		elseif theData == "maps" then
			for k,v in pairs(Shop[data["curshop"]]["MapAvailable"]) do
				if v == value then
					mapsAvailable = true
					break
				end
			end
			
		elseif theData == "curshop" then
			
		end
	end
	
	if reason == "" then
		if not gamemodeAvailable then
			reason = trad[lang]["modeUnavailable"]
		end
		if not gamemodeAvailable2 then
			reason = trad[lang]["modeUnavailable2"]
		end
		if not mapsAvailable then
			reason = trad[lang]["mapUnavailable"]
		end
	end
	if reason == "" then
		-- print("all ok")
		TriggerServerEvent("PlasmaKart:AskForCreateAlobby",data)
		
		
	else
		notification(reason,"error")
	end
end)

RegisterNetEvent("PlasmaKart:OkForCreateAlobby")
AddEventHandler("PlasmaKart:OkForCreateAlobby", function(data)
	TriggerServerEvent("PlasmaKart:NewSession",data)
end)




newPool = MenuPool.New()
mainMenu = UIMenu.New("Karting", trad[lang]["Lobby"])
newPool:Add(mainMenu)

Citizen.CreateThread(function()
    while true do
        Citizen.Wait(1)
		 if (newPool:IsAnyMenuOpen()) then
            newPool:ProcessMenus()
		else 
			Citizen.Wait(50)
        end
    end
end)



RegisterNetEvent("PlasmaKart:SendSession")
AddEventHandler("PlasmaKart:SendSession", function(session,isOwner)
	mainMenu = UIMenu.New("Karting", session["LobbyName"])
	newPool:Add(mainMenu)
	
	item1 = UIMenuItem.New(trad[lang]["Join"], "")
    mainMenu:AddItem(item1)
	
	if isOwner then
		item2 = UIMenuItem.New(trad[lang]["Start"], "")
		mainMenu:AddItem(item2)
		
		item3 = UIMenuItem.New(trad[lang]["Delete"], "")
		mainMenu:AddItem(item3)
	end
	
	mainMenu.OnItemSelect = function(sender, item, index)
		if item == item1 then
			print("Rejoindre")
			TriggerServerEvent("PlasmaKart:JoinSession",session["Shop"])
		elseif item == item2 then
			print("Lancer")
			TriggerServerEvent("PlasmaKart:StartSession",session["Shop"])
		elseif item == item3 then
			print("Supprimer")
			TriggerServerEvent("PlasmaKart:AskDeleteSession",session["Shop"],true)
		end
	end
	mainMenu:Visible(true)
end)


RegisterNetEvent("PlasmaKart:SendOrder")
AddEventHandler("PlasmaKart:SendOrder", function(order)
	currentPos = order
end)

RegisterNetEvent("PlasmaKart:SendFinalPos")
AddEventHandler("PlasmaKart:SendFinalPos", function(order)
	lastPos = order
	if order == 1 then 
		ShowMPMessage("~g~"..tostring(order)..trad[lang]["First"],"",7000)
	elseif order == 2 then
		ShowMPMessage("~g~"..tostring(order)..trad[lang]["Second"],"",7000)
	elseif order == 3 then
		ShowMPMessage("~g~"..tostring(order)..trad[lang]["Third"],"",7000)
	elseif order == 4 then
		ShowMPMessage("~g~"..tostring(order)..trad[lang]["Fourth"],"",7000)
	else
		ShowMPMessage("~g~"..tostring(order)..trad[lang]["otherplacement"],"",7000)
	end
end)

function ShowMPMessage(message, subtitle, ms)
	-- do this in another thread
	Citizen.CreateThread(function()
		local scaleform = RequestScaleformMovie("mp_big_message_freemode")
		while not HasScaleformMovieLoaded(scaleform) do
			Citizen.Wait(1)
		end
		
		BeginScaleformMovieMethod(scaleform, "SHOW_SHARD_WASTED_MP_MESSAGE")
		PushScaleformMovieMethodParameterString(message)
		PushScaleformMovieMethodParameterString(subtitle)
		PushScaleformMovieMethodParameterInt(0)
		EndScaleformMovieMethod()

		local time = GetGameTimer() + ms
        
        while(GetGameTimer() < time) do
			Citizen.Wait(1)
			DrawScaleformMovieFullscreen(scaleform, 255, 255, 255, 255)
		end
	end)
end

RegisterNetEvent("PlasmaKart:SendthePREStartSession")
AddEventHandler("PlasmaKart:SendthePREStartSession", function(session,pos)
	currentKart = 0
	DoScreenFadeOut(1)
	while not IsScreenFadedOut() do
		Wait(0)
	end
	Wait(1000)
	DoScreenFadeIn(500)
	switchTenu()
	teleport(session["Maps"]["startPos"][pos])
	kart = spawnKart(session["Cylindre"].."cc")
	TriggerServerEvent("PlasmaKart:SendKartId",NetworkGetNetworkIdFromEntity(kart),session["Shop"])
	currentKart = kart

end)

--local options =
--			{	
--				onPlayStart = function(event) -- event argument returns getInfo(id)
--					-- print("start of :"..event.url)
--				end,
--				onPlayEnd = function(event) 
--					-- print("end of : "..event.url)
--					stepfinished = true
--				end,
--			}
			
RegisterNetEvent("PlasmaKart:SendtheStartSession")
AddEventHandler("PlasmaKart:SendtheStartSession", function(session,pos)
	print("SendtheStartSession")
	Pist = session["Maps"]
	Race["nblap"] = tonumber(session["Lap"])
	currentSession = session
	inRace = true
	boostTimer = 0.0
	spikeTimer = 0.0
	
	curCP = 0
	curLap = 1
	currentPos = 0
	lastPos = 0
	
	stopcam()
	-- switchTenu()
	-- teleport(session["Maps"]["startPos"][pos])
	-- kart = spawnKart(session["Cylindre"].."cc")
	-- TriggerServerEvent("PlasmaKart:SendKartId",NetworkGetNetworkIdFromEntity(kart),currentSession["Shop"])
	
	ShowMPMessage("~g~10",trad[lang]["beready"],1000)
	local curtime = GetGameTimer() + 950
	while(GetGameTimer() < curtime) do
		Citizen.Wait(1)
	end
	
	
	ShowMPMessage("~g~9",trad[lang]["beready"],1000)
	local curtime = GetGameTimer() + 950
	while(GetGameTimer() < curtime) do
		Citizen.Wait(1)
	end
	
	
	ShowMPMessage("~g~8",trad[lang]["beready"],1000)
	local curtime = GetGameTimer() + 950
	while(GetGameTimer() < curtime) do
		Citizen.Wait(1)
	end
	
	
	ShowMPMessage("~g~7",trad[lang]["beready"],1000)
	local curtime = GetGameTimer() + 950
	while(GetGameTimer() < curtime) do
		Citizen.Wait(1)
	end
	
	
	ShowMPMessage("~g~6",trad[lang]["beready"],1000)
	local curtime = GetGameTimer() + 950
	while(GetGameTimer() < curtime) do
		Citizen.Wait(1)
	end
	
	
	ShowMPMessage("~g~5",trad[lang]["beready"],1000)
	if UseSound then
		xSound:PlayUrlPos("ctd5",PreStartSound,0.5,GetEntityCoords(PlayerPedId()),false, {})
	end
	local curtime = GetGameTimer() + 950
	while(GetGameTimer() < curtime) do
		Citizen.Wait(1)
	end
	
	
	ShowMPMessage("~g~4",trad[lang]["beready"],1000)
	if UseSound then
		xSound:PlayUrlPos("ctd4",PreStartSound,0.5,GetEntityCoords(PlayerPedId()),false, {})
	end
	local curtime = GetGameTimer() + 950
	while(GetGameTimer() < curtime) do
		Citizen.Wait(1)
	end
	
	
	ShowMPMessage("~g~3",trad[lang]["beready"],1000)
	if UseSound then
		xSound:PlayUrlPos("ctd3",PreStartSound,0.5,GetEntityCoords(PlayerPedId()),false, {})
	end
	local curtime = GetGameTimer() + 950
	while(GetGameTimer() < curtime) do
		Citizen.Wait(1)
	end
	
	
	ShowMPMessage("~g~2",trad[lang]["beready"],1000)
	if UseSound then
		xSound:PlayUrlPos("ctd2",PreStartSound,0.5,GetEntityCoords(PlayerPedId()),false, {})
	end
	local curtime = GetGameTimer() + 950
	while(GetGameTimer() < curtime) do
		Citizen.Wait(1)
	end
	
	
	ShowMPMessage("~g~1",trad[lang]["beready"],1000)
	if UseSound then
		xSound:PlayUrlPos("ctd1",PreStartSound,0.5,GetEntityCoords(PlayerPedId()),false, {})
	end
	local curtime = GetGameTimer() + 950
	while(GetGameTimer() < curtime) do
		Citizen.Wait(1)
	end
	
	
	ShowMPMessage("~g~0",trad[lang]["gogo"],1000)
	local veh = GetVehiclePedIsIn(PlayerPedId(),false)
	FreezeEntityPosition(kart,false)
	FreezeEntityPosition(veh,false)
	
	TriggerServerEvent("PlasmaKart:CpPassed",currentSession["Shop"],0,0)
	if UseSound then
		-- xSound:PlayUrl("name",StartSound,1,coords, false, options)
		xSound:PlayUrlPos("ctd0",StartSound,0.5,GetEntityCoords(PlayerPedId()),false, {})
	end
end)


RegisterNetEvent("PlasmaKart:SendTiming")
AddEventHandler("PlasmaKart:SendTiming", function(timec)
	TriggerEvent("pNotify:SendNotification", {text = string.format("elapsed time: %.2f",timec), type = "success", timeout = 2000, layout = "bottomLeft"})
end)

RegisterNetEvent("PlasmaKart:ReceiveSound")
AddEventHandler("PlasmaKart:ReceiveSound", function(id,sound,vol,coords)
	-- TriggerEvent("pNotify:SendNotification", {text = string.format("elapsed time: %.2f",timec), type = "success", timeout = 2000, layout = "bottomLeft"})
	print("Received coords : "..tostring(coords))
	local coordstab = {}
	coordstab.x, coordstab.y, coordstab.z = table.unpack(coords)
	if inRace == true then
		xSound:PlayUrlPos(-1,id,sound,vol,coordstab, false, {})
	end	
end)


function RetournKart()
	local veh = GetVehiclePedIsIn(PlayerPedId(),false)
	
	if veh == 0 then veh = currentKart end
	local coords = {}
	
	coords.x,coords.y,coords.z = table.unpack(GetEntityCoords(veh))

	SetEntityCoords(veh,coords.x,coords.y,coords.z+1.0)
	SetEntityRotation(veh,0,0.0,0,0,false)

end

function ReturnToLastCheckPoint()
	local veh = GetVehiclePedIsIn(PlayerPedId(),false)
	cpCoords = Pist["CP"][curCP]
	SetEntityCoords(veh,cpCoords.x,cpCoords.y,cpCoords.z+1.0)
	-- SetEntityRotation(veh,0,0.0,0,0,false)
	SetEntityHeading(kart,cpCoords.h)
end

RegisterNetEvent("PlasmaKart:SendTheEnd")
AddEventHandler("PlasmaKart:SendTheEnd", function(shop)
	print("PlasmaKart SendTheEnd : "..tostring(shop).." currentKart: "..tostring(currentKart))
	inRace = false
	DeleteEntity(currentKart)
	teleport(Shop[shop]["EndCoords"])
	switchTenu()
	
	if lastPos == 1 then
		ShowMPMessage("~g~"..tostring(lastPos)..trad[lang]["First"],trad[lang]["GoodGamed"],7000)
		teleport(Shop[shop]["EndCoords1st"])
	elseif lastPos == 2 then
		ShowMPMessage("~g~"..tostring(lastPos)..trad[lang]["Second"],trad[lang]["NiceTry"],7000)
		teleport(Shop[shop]["EndCoords2nd"])
	elseif lastPos == 3 then
		ShowMPMessage("~g~"..tostring(lastPos)..trad[lang]["Third"],trad[lang]["NiceTry"],7000)
		teleport(Shop[shop]["EndCoords3rd"])
	elseif lastPos == 4 then
		ShowMPMessage("~g~"..tostring(lastPos)..trad[lang]["Fourth"],trad[lang]["NiceTry"],7000)
		teleport(Shop[shop]["EndCoords"])
	else
		ShowMPMessage("~g~"..tostring(lastPos)..trad[lang]["otherplacement"],trad[lang]["NiceTry"],7000)
		teleport(Shop[shop]["EndCoords"])
	end
	
	-- ShowMPMessage("~g~"..tostring(lastPos).."EME","Bien essayé !",5000)
end)




local playerTenu = {
[3] = {model = 0, color = 2},
[4] = {model = 0, color = 2},
[6] = {model = 0, color = 3},
						   
[7] = {model = 0, color = 2},
[8] = {model = 0, color = 2},
[11] = {model = 0, color = 2}
}

local playerMask = {model = 0, color = 2}

function switchTenu(color)
	local sex 
	local ped = PlayerPedId()
	if IsPedModel(ped,GetHashKey('mp_m_freemode_01')) then
		sex = "men"
	elseif IsPedModel(ped,GetHashKey('mp_f_freemode_01')) then
		sex = "women"
	end
	
	if not isCostumed then -- Si n' pas sa tenue
		playerTenu[11].model = GetPedDrawableVariation(ped,11)
		playerTenu[11].color = GetPedTextureVariation(ped,11)
		
		playerTenu[4].model = GetPedDrawableVariation(ped,4)
		playerTenu[4].color = GetPedTextureVariation(ped,4)
		
		playerTenu[6].model = GetPedDrawableVariation(ped,6)
		playerTenu[6].color = GetPedTextureVariation(ped,6)
		
		playerTenu[7].model = GetPedDrawableVariation(ped,7)
		playerTenu[7].color = GetPedTextureVariation(ped,7)
		
		playerTenu[8].model = GetPedDrawableVariation(ped,8)
		playerTenu[8].color = GetPedTextureVariation(ped,8)
		
		playerTenu[3].model = GetPedDrawableVariation(ped,3)
		playerTenu[3].color = GetPedTextureVariation(ped,3)
		if sex == "men" then
			isCostumed = true
			local randColor = math.random(0,GetNumberOfPedTextureVariations(ped,4,TenuHomme[4].model)-2)
			-- local randColor = 
			for k,v in pairs(TenuHomme) do
				if v.color ~= nil then
				SetPedComponentVariation(ped,k,v.model, v.color,2)
				else
				SetPedComponentVariation(ped,k,v.model,randColor,2)
				end
			end
			if useCustomMask then
				local randMath = math.random(1,2)
				playerMask.model = GetPedDrawableVariation(PlayerPedId(), 1)
				playerMask.color = GetPedTextureVariation(PlayerPedId(), 1)
				print("Mask : "..tostring(playerMask.model).." "..tostring(playerMask.color))
				SetPedComponentVariation(PlayerPedId(), 1, MaskHomme[randMath].model, MaskHomme[randMath].colorA, 0)
			end
		else
			isCostumed = true
			local randColor = math.random(2,GetNumberOfPedTextureVariations(ped,4,TenuFemme[4].model)-1)
			for k,v in pairs(TenuFemme) do
				if v.color ~= nil then
				SetPedComponentVariation(ped,k,v.model, v.color,2)
				else
				SetPedComponentVariation(ped,k,v.model,randColor,2)
				end
			end
			if useCustomMask then
				local randMath = math.random(1,2)
				playerMask.model = GetPedDrawableVariation(PlayerPedId(), 1)
				playerMask.color = GetPedTextureVariation(PlayerPedId(), 1)
				print("Mask : "..tostring(playerMask.model).." "..tostring(playerMask.color))
				SetPedComponentVariation(PlayerPedId(), 1, MaskFemme[randMath].model, MaskFemme[randMath].colorB, 0)
			end
		end
	else
		isCostumed = false
		for k,v in pairs(playerTenu) do
			SetPedComponentVariation(ped,k,v.model,v.color,2)
		end
		if useCustomMask then
			SetPedComponentVariation(PlayerPedId(), 1, playerMask.model, playerMask.color, 0)
		end
	end
end





-- HFLAOT = 0.0
-- RegisterCommand("float", function(source, args, fullCommand)
	
	-- vehicle = GetVehiclePedIsUsing(PlayerPedId())
	-- HFLAOT = GetVehicleHandlingFloat(vehicle, 'CHandlingData', 'fTractionLossMult')
	-- print("HFLAOT: "..tostring(HFLAOT))
-- end, false)


-- HERSE       p_stinger_02








local spike

function setSpikesOnGround()
    local ped = PlayerPedId()
	local kart = GetVehiclePedIsIn(ped,false)
    x, y, z = table.unpack(GetEntityCoords(ped, true))
	h = GetEntityHeading(ped)
	rotx,roty,rotz = table.unpack(GetEntityRotation(kart))
	ox, oy, oz = table.unpack(GetOffsetFromEntityInWorldCoords(ped, -1.0, -1.5, 0.0))
	
	
	spike = GetHashKey("p_stinger_02")

    RequestModel(spike)
    while not HasModelLoaded(spike) do
      Citizen.Wait(1)
    end

    local object = CreateObject(spike, ox, oy, oz-0.15, true, true, false)
	-- SetEntityCollision(object,true,true)
	-- SetEntityLoadCollisionFlag(object,true)
	
	SetEntityHeading(object, h+90.0)
	ApplyForceToEntity(object,3,vector3(0.0, 0.0, -1.0),vector3(0.0, 0.0, 0.0),0,false,true,true,false,true)
	
	print("rot : "..tostring(GetEntityRotation(object)))
	TriggerServerEvent("PlasmaKart:SendHerseId",NetworkGetNetworkIdFromEntity(object),currentSession["Shop"],GetEntityCoords(object))
end

Citizen.CreateThread(function()
	while true do
		Citizen.Wait(2)
		if inRace then
			if currentSession["Mode"] == "Battle" then
				-- Citizen.Wait(1)
				local ped = PlayerPedId()
				local pedCoords = GetEntityCoords(ped)
				local spike2 = GetClosestObjectOfType(pedCoords, 9.0, GetHashKey("p_stinger_02"))
				if spike2 ~= 0 then
					spcoords = GetOffsetFromEntityInWorldCoords(spike2,.2,-1.0,0.0)
					local netId = NetworkGetNetworkIdFromEntity(spike2)
					-- DrawMarker(0,  spcoords,  .0,.0,.0,  .0,.0,.0,  1.0,1.0,1.0,  128,0,0,64, false,false,2,false)
					
					-- print("dist : "..tostring(#(pedCoords - spcoords)))
					if (#(pedCoords - spcoords)) < 1.35 then
						local veh = GetVehiclePedIsIn(ped)
						SetVehicleTyresCanBurst(veh,true)
						SetVehicleTyreBurst(veh, 0, true, 1000.0)
						SetVehicleTyreBurst(veh, 1, true, 1000.0)
						SetVehicleTyreBurst(veh, 4, true, 1000.0)
						SetVehicleTyreBurst(veh, 5, true, 1000.0)
						TriggerServerEvent("PlasmaKart:AskForSpikeDelete",netId)
						
						-- local cptTimeout = 0
						-- NetworkRequestControlOfEntity(spike2)
						-- while not NetworkHasControlOfEntity(spike2) do
							-- Wait(1)
							-- NetworkRequestControlOfEntity(spike2)
							-- cptTimeout = cptTimeout + 1
							-- if cptTimeout > 10 then break end
						-- end
						-- DeleteEntity(spike2)
						Wait(1500)
						SetVehicleTyreFixed(veh,0)
						SetVehicleTyreFixed(veh,1)
						SetVehicleTyreFixed(veh,4)
						SetVehicleTyreFixed(veh,5)
						SetVehicleTyresCanBurst(veh,false)
					
					end
				end
			else
				Wait(1000)
			end
		else
			Wait(1000)
		end
    end
end)













function boost()
	local ModelHash = `stt_prop_track_speedup` -- Use Compile-time hashes to get the hash of this model
	if not IsModelInCdimage(ModelHash) then return end
	RequestModel(ModelHash) -- Request the model
	while not HasModelLoaded(ModelHash) do -- Waits for the model to load with a check so it does not get stuck in an infinite loop
	  Citizen.Wait(10)
	end
	local coords = {}
	coords.x,coords.y,coords.z = table.unpack(GetOffsetFromEntityInWorldCoords(PlayerPedId(),.0,2.0,0.0))
	coords.h = GetEntityHeading(PlayerPedId())+90.0
	booster = CreateObject(ModelHash,coords.x,coords.y,coords.z-0.6,false,false,false)
	SetEntityVisible(booster,false)
	SetEntityHeading(booster,coords.h)
	local rot = {}
	print(GetEntityRotation(booster))
	-- rot.x,rot.y,rot.z = table.unpack(GetEntityRotation(booster))
	-- SetEntityRotation(booster,rot.x+90.0,rot.y+90.0,rot.z,0,false)
	Wait(100)
	DeleteEntity(booster)
	TriggerServerEvent("PlasmaKart:BoostSound",GetEntityCoords(PlayerPedId()))
-- glisse22 = false

end

local vardemerde = true
--------------Travelling
local waitingPath = {
	[0]={x=-2293.7905273438,y=253.31828308105,z=108.46138763428,h=14.33929443359},
	[1]={x=-2361.4660644531,y=183.6901550293,z=109.63864135742,h=348.06118774414},
	[2]={x=-2355.6237792969,y=263.61306762695,z=109.08701324463,h=271.38264465332},
	[3]={x=-2317.3940429688,y=279.9997253418,z=110.892578125,h=194.70770072937},
	[4]={x=-2311.486328125,y=297.33401489258,z=109.36179351807,h=194.20388793945},
}


RegisterNetEvent("PlasmaKart:Cam")
AddEventHandler("PlasmaKart:Cam", function(maps)
	print("create cam for : "..tostring(maps))
	createCam(Maps[maps.Name].waitingPath)
end)

local cam
function createCam(data)
	print("createCam")
	
	cam = CreateCamWithParams("DEFAULT_SPLINE_CAMERA", GetEntityCoords(PlayerPedId()), 0, 0, 0, GetGameplayCamFov() * 1.0)
	duration = 5000
	vardemerde = true
	for k,v in pairs(data) do
		
		-- print("RandZ : "..tostring(randZ))
		AddCamSplineNode(cam,v.x,v.y,v.z,0,0,v.h+0.001,duration,3,2)
		-- OverrideCamSplineVelocity(cam,k,200.0,200.0)
		-- SetCamSplineDuration(2000)
		-- randZ = randZ + 30.0
		-- if randZ > 360.0 then randZ = randZ - 360.0 end
		-- Wait(1000)
	end
    SetCamActive(cam, true)
    RenderScriptCams(true, false, 1, true, false)
    SetCamSplinePhase(cam,1)
	Citizen.CreateThread(function()
		while vardemerde do
			Wait(100)
			-- local camrot = {}
			-- camrot.x,camrot.y,camrot.z = table.unpack(GetCamRot(cam,2))
			-- print("Cam node: "..tostring(GetCamSplineNodeIndex(cam)).." Node phase: "..tostring(GetCamSplineNodePhase(cam)))
			local camCoords = {}
			camCoords.x,camCoords.y,camCoords.z = table.unpack(GetCamCoord(cam))
			-- SetFocusPosAndVel(camCoords.x,camCoords.y,camCoords.z,camCoords.x,camCoords.y,camCoords.z)
			-- SetEntityCoords(PlayerPedId(),camCoords.x,camCoords.y,camCoords.z-75.0)
			-- FreezeEntityPosition(PlayerPedId(),true)
			-- OverrideCamSplineVelocity(cam,1,200.0,200.0)
			-- SetCamRot(cam,0,0,camrot.z+1.0,2)
			local phase = GetCamSplinePhase(cam)
			local node = GetCamSplineNodeIndex(cam)
			print("node: "..tostring(node).." phase : "..tostring(phase))
			if not IsCamInterpolating(cam) then
				print("IsCamInterpolating")
				  SetCamSplinePhase(cam,1)
			end
		end
		SetCamActive(cam, false)
		vardemerde = false
		RenderScriptCams(0)
		local camCoords = {}
		camCoords.x,camCoords.y,camCoords.z = table.unpack(GetEntityCoords(PlayerPedId()))
		SetFocusPosAndVel(camCoords.x,camCoords.y,camCoords.z,0,0,0)
		ClearFocus()
	end)
end

function stopcam()
	vardemerde = false
		RenderScriptCams(0)
		local camCoords = {}
		camCoords.x,camCoords.y,camCoords.z = table.unpack(GetEntityCoords(PlayerPedId()))
		SetFocusPosAndVel(camCoords.x,camCoords.y,camCoords.z,0,0,0)
		ClearFocus()
		
		DestroyCam(cam,true)
		DestroyCam(cam,false)

end

RegisterCommand("DelKartSession", function(source, args, fullCommand)
	-- createCam()
	if args[1] ~= nil or args[1] ~= "" then
		if Shop[tostring(args[1])] ~= nil then
		TriggerServerEvent("PlasmaKart:AskDeleteSession",args[1],false)
		else
			print("Invalid arguments, Valid shop are :")
			print("--------------------------------------------------")
			for k,v in pairs(Shop) do
				print(tostring(k))
			end
			print("--------------------------------------------------")
		end
	else
		print("Must pass at least one arguments, Valid shop are :")
		print("--------------------------------------------------")
		for k,v in pairs(Shop) do
			print(tostring(k))
		end
		print("--------------------------------------------------")
	end
end, false)

RegisterCommand("getIdentifier", function(source, args, fullCommand)


		TriggerServerEvent("PlasmaKart:getIdentifier")
	
end, false)

--RegisterCommand("createcam22", function(source, args, fullCommand)
--	createCam()
--end, false)
--
--RegisterCommand("stopcam22", function(source, args, fullCommand)
--		vardemerde = false
--		RenderScriptCams(0)
--		local camCoords = {}
--		camCoords.x,camCoords.y,camCoords.z = table.unpack(GetEntityCoords(PlayerPedId()))
--		SetFocusPosAndVel(camCoords.x,camCoords.y,camCoords.z,0,0,0)
--		ClearFocus()
--		
--		DestroyCam(cam,true)
--		DestroyCam(cam,false)
--end, false)
--
----SOUND
--RegisterCommand("testspike", function(source, args, fullCommand)
--		setSpikesOnGround()
--end, false)
--
--
--RegisterCommand("sound1", function(source, args, fullCommand)
--	-- TriggerServerEvent("PlasmaKart:Sound1",GetEntityCoords(PlayerPedId()))
--	print(PreStartSound)
--	xSound:PlayUrlPos("name",PreStartSound,0.5,GetEntityCoords(PlayerPedId()),false, {})
--	-- local options =
--			-- {	
--				-- onPlayStart = function(event) -- event argument returns getInfo(id)
--					-- print("start of :"..event.url)
--				-- end,
--				-- onPlayEnd = function(event) 
--					-- print("end of : "..event.url)
--					-- stepfinished = true
--				-- end,
--			-- }  
--	-- xSound:PlayUrlPos("name","./sounds/Mario_Bip.ogg",1,GetEntityCoords(PlayerPedId()), false, options)
--end, false)
--
--
--
--RegisterCommand("sound2", function(source, args, fullCommand)
--	local options =
--			{	
--				onPlayStart = function(event) -- event argument returns getInfo(id)
--					print("start of :"..event.url)
--				end,
--				onPlayEnd = function(event) 
--					print("end of : "..event.url)
--					stepfinished = true
--				end,
--			}  
--	xSound:PlayUrlPos("name","./sounds/Mario_DEPART_bip.ogg",1,GetEntityCoords(PlayerPedId()), false, options)
--end, false)
--
--
--
--RegisterCommand("sound3", function(source, args, fullCommand)
--	local options =
--			{	
--				onPlayStart = function(event) -- event argument returns getInfo(id)
--					print("start of :"..event.url)
--				end,
--				onPlayEnd = function(event) 
--					print("end of : "..event.url)
--					stepfinished = true
--				end,
--			}  
--	xSound:PlayUrlPos("name","./sounds/MarioSpike.ogg",1,GetEntityCoords(PlayerPedId()), false, options)
--end, false)



RegisterCommand("leaveKart", function(source, args, fullCommand)
	if inRace then
		-- switchTenu()
		notification(trad[lang]["leaveRaceOK"])
		TriggerServerEvent("PlasmaKart:Leave",currentSession["Shop"])
		
	else
		notification(trad[lang]["leaveRace"])
		
	end
end, false)


--RegisterCommand("switchtenu", function(source, args, fullCommand)
--	print("switchtenu")
--	switchTenu()
--end, false)
--
--
--RegisterCommand("retournkart", function(source, args, fullCommand)
--	print("retourn")
--	local veh = GetVehiclePedIsIn(PlayerPedId(),false)
--	
--	if veh == 0 then veh = currentKart end
--	local coords = {}
--	
--	coords.x,coords.y,coords.z = table.unpack(GetEntityCoords(veh))
--
--	SetEntityCoords(veh,coords.x,coords.y,coords.z+1.0)
--	SetEntityRotation(veh,0,-180.0,0,0,false)
--end, false)
--
--
--
--RegisterCommand("kart", function(source, args, fullCommand)
--	if args[1] == "50cc" or args[1] == "100cc" or args[1] == "150cc" or args[1] == "200cc" then
--		print("spawn kart cyl : "..tostring(args[1]))
--		kart = spawnKart(args[1])
--		FreezeEntityPosition(kart,false)
--	else
--		print("spawn default kart cyl : 50cc")
--		spawnKart("50cc")
--		FreezeEntityPosition(kart,false)
--	end
--end, false)
--
--RegisterCommand("booster", function(source, args, fullCommand)
--	local ModelHash = `stt_prop_track_speedup` -- Use Compile-time hashes to get the hash of this model
--	if not IsModelInCdimage(ModelHash) then return end
--	RequestModel(ModelHash) -- Request the model
--	while not HasModelLoaded(ModelHash) do -- Waits for the model to load with a check so it does not get stuck in an infinite loop
--	  Citizen.Wait(10)
--	end
--	local coords = {}
--	coords.x,coords.y,coords.z = table.unpack(GetEntityCoords(PlayerPedId()))
--	coords.h = GetEntityHeading(PlayerPedId())+90.0
--	booster = CreateObject(ModelHash,coords.x,coords.y,coords.z-0.6,true,true,false)
--	SetEntityHeading(booster,coords.h)
--	local rot = {}
--	print(GetEntityRotation(booster))
--	rot.x,rot.y,rot.z = table.unpack(GetEntityRotation(booster))
--	SetEntityRotation(booster,rot.x+90.0,rot.y+90.0,rot.z,0,false)
--	
--	-- SetEntityVisible(booster,false)
--	
--	-- local vehicle22 = GetVehiclePedIsIn(PlayerPedId(), false)
--	-- SetVehicleBoostActive(vehicle22,true)
--	-- SetEnableVehicleSlipstreaming(true)
--	-- Wait(4000)
--	-- SetEnableVehicleSlipstreaming(false)
--	-- SetVehicleBoostActive(vehicle22,false)
--end, false)
--
--RegisterCommand("delbooster", function(source, args, fullCommand)
--	DeleteEntity(booster)
--end, false)
--
--
--RegisterCommand("light", function(source, args, fullCommand)
--	print("spawn light")
--	local ModelHash2 = GetHashKey("sarish_neon_kart") -- Use Compile-time hashes to get the hash of this model
--	if not IsModelInCdimage(ModelHash2) then return end
--	RequestModel(ModelHash2) -- Request the model
--	while not HasModelLoaded(ModelHash2) do -- Waits for the model to load with a check so it does not get stuck in an infinite loop
--	  Citizen.Wait(10)
--	end
--	
--	 light = CreateObject(ModelHash2,GetEntityCoords(PlayerPedId()),true,true,false)
--	 print("CreateObject light")
--	 FreezeEntityPosition(light,true)
--	 -- SetEntityLights(light,false)
--	 -- SetObjectLightColor(light,1,255,0,0)
--	 -- UpdateLightsOnEntity(light)
--	 -- SetEntityAlpha(light,255,true)
--end, false)
--
---- RegisterCommand("light", function(source, args, fullCommand)
--	-- DeleteEntity(light)
--	
---- end, false)
--
--RegisterCommand("dellight", function(source, args, fullCommand)
--	DeleteEntity(light)
--end, false)
--
--RegisterCommand("oil", function(source, args, fullCommand)
--	DropOil()
--end, false)
---- stt_prop_track_speedup
--
--
--
--
--RegisterCommand("timer", function(source, args, fullCommand)
--	TriggerServerEvent("PlasmaKart:timer")
--end, false)